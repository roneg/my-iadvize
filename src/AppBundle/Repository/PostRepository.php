<?php

namespace AppBundle\Repository;

use AppBundle\Entity\Post;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\JsonResponse;

/**
 * PostRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PostRepository extends \Doctrine\ORM\EntityRepository
{
    public function createPost()
    {  
        $em = $this->getEntityManager();

        $post = new Post();
        $post->setContent('Message');
        $post->setDate(new \DateTime('2014-01-01 00:00:00'));
        $post->setAuthor('Me');

        $em->persist($post);

        // actually executes the queries (i.e. the INSERT query)
        $em->flush();
        var_dump($post);

        return new Response('Saved new post with id '.$post->getId());
    }

    public function getPosts()
    {
        $em = $this->getEntityManager();

        $query = $em->createQuery("select p from AppBundle\Entity\Post p");
        $posts = $query->getArrayResult();
        var_dump($posts);

        // return new Response('List of Posts entities');
        return new JsonResponse($posts);
    }

    public function save(Post $post)
    {
        $em = $this->getEntityManager();
        $em->persist($post);
        $em->flush();
    }
}
